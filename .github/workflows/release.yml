name: WordPress Plugin Release

on:
  push:
    tags:
      - 'v*' # Trigger the workflow when a version (v) tag is pushed

jobs:
  build-and-release:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Check out the repository
      - name: Checkout code
        uses: actions/checkout@v3

      # Step 2: Package the plugin
      - name: Create plugin ZIP
        run: |
          mkdir -p dist/iti-mpfy-extensions
          rsync -av --exclude='.git*' --exclude='node_modules' --exclude='dist' --exclude='.github' . dist/iti-mpfy-extensions/
          cd dist
          zip -r iti-mpfy-extensions-${{ github.ref_name }}.zip iti-mpfy-extensions

      # Step 3: Create a GitHub Release
      - name: Create GitHub Release
        uses: actions/create-release@v1
        with:
          tag_name: ${{ github.ref_name }}
          release_name: ${{ github.ref_name }}
          body: |
            New release of ITI Mapify Extensions.
            - Automatically generated by GitHub Actions.
          draft: false
          prerelease: false
          files: dist/iti-mapify-extensions-${{ github.ref_name }}.zip
